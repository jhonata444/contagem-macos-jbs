<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Contagem de Maços - Casings</title>
    
    <!-- INCLUINDO A BIBLIOTECA jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- ESTILOS (CSS) -->
    <style>
        :root {
            --primary-color: #c8102e; /* Vermelho JBS */
            --secondary-color: #f8f9fa; 
            --text-color: #333;
            --border-color: #ddd; 
            --white-color: #fff; 
            --danger-color: #dc3545; 
            --success-color: #28a745;
            --dark-gray: #343a40;
            --light-gray: #6c757d;
        }
        
        /* ANIMAÇÃO DE ABERTURA - SIMPLIFICADA */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .splash-logo {
            font-family: 'Arial', sans-serif;
            font-size: 4em;
            font-weight: bold;
            color: #c8102e;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .splash-subtitle {
            font-family: 'Arial', sans-serif;
            font-size: 1.2em;
            color: #333;
            text-align: center;
            font-weight: bold;
        }
        
        .splash-loading {
            margin-top: 20px;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(200, 16, 46, 0.3);
            border-top: 3px solid #c8102e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ESTILOS PRINCIPAIS */
        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--secondary-color); 
            color: var(--text-color); 
            margin: 0; 
            padding: 15px;
            display: flex; 
            justify-content: center;
        }
        
        .container {
            max-width: 600px; 
            width: 100%; 
            background: var(--white-color); 
            padding: 20px;
            border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary-color);
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            background: linear-gradient(to right, #f8f9fa, #e9ecef, #f8f9fa);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .logo-text {
            font-family: 'Arial', sans-serif;
            font-size: 2.2em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0;
            line-height: 1.2;
        }
        
        .logo-subtitle {
            font-family: 'Arial', sans-serif;
            font-size: 1em;
            font-weight: bold;
            color: var(--dark-gray);
            margin-top: 5px;
        }
        
        h1, h2, h3 { 
            text-align: center; 
            color: #4a4a4a; 
        }
        
        h1 { 
            font-size: 1.5em; 
            margin-bottom: 25px; 
            color: var(--dark-gray);
            font-weight: 600;
        }
        
        h2 { 
            border-bottom: 2px solid #eee; 
            padding-bottom: 10px; 
            margin-top: 25px; 
            margin-bottom: 15px; 
            font-size: 1.2em; 
            color: var(--dark-gray);
            font-weight: 600;
        }
        
        h3 { 
            font-size: 1.1em; 
            margin-bottom: 10px; 
            text-align: left; 
            color: var(--dark-gray);
            font-weight: 600;
        }
        
        input[type="number"], input[type="text"] {
            width: 100%; 
            padding: 16px; 
            margin-bottom: 10px; 
            border: 1px solid var(--border-color);
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 1.2em; 
            text-align: center;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(200, 16, 46, 0.2);
            outline: none;
        }
        
        .select-group { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        .select-group button {
            padding: 15px 5px; 
            font-size: 1em; 
            font-weight: bold; 
            color: var(--primary-color);
            background-color: var(--white-color); 
            border: 2px solid var(--primary-color); 
            border-radius: 8px;
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        
        .select-group button:hover {
            background-color: #f8f9fa;
        }
        
        .select-group button.selected { 
            background-color: var(--primary-color); 
            color: var(--white-color); 
        }
        
        .add-button {
            width: 100%; 
            padding: 18px; 
            font-size: 1.2em; 
            font-weight: bold; 
            color: var(--white-color);
            background-color: var(--success-color); 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .add-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        #maco-list { 
            list-style: none; 
            padding: 0; 
            max-height: 200px; 
            overflow-y: auto; 
            border: 1px solid #eee; 
            border-radius: 8px; 
        }
        
        #maco-list li { 
            padding: 12px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: background-color 0.2s;
        }
        
        #maco-list li:hover {
            background-color: #f8f9fa;
        }
        
        #maco-list li:last-child { 
            border-bottom: none; 
        }
        
        .delete-btn { 
            background: none; 
            border: none; 
            color: var(--danger-color); 
            font-size: 1.5em; 
            cursor: pointer; 
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            transform: scale(1.2);
        }
        
        .total-section p { 
            display: flex; 
            justify-content: space-between; 
            font-size: 1.1em; 
            padding: 8px 0; 
            margin: 0; 
        }
        
        .total-section .grand-total { 
            font-weight: bold; 
            font-size: 1.3em; 
            padding-top: 10px; 
            border-top: 2px solid #eee; 
            margin-top: 10px; 
            color: var(--primary-color);
        }
        
        .total-section .converted-total { 
            font-weight: bold; 
            font-size: 1.2em; 
            padding-top: 10px; 
            margin-top: 10px; 
            color: var(--success-color);
        }
        
        .total-section span { 
            font-weight: bold; 
        }
        
        .action-buttons { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 12px; 
            margin-top: 25px; 
        }
        
        .action-buttons button { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            font-size: 1.1em; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s ease;
        }
        
        .print-button { 
            background-color: var(--primary-color); 
        }
        
        .print-button:hover {
            background-color: #a50d26;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .email-button { 
            background-color: #007bff; 
        }
        
        .email-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .reset-button { 
            background-color: var(--danger-color); 
        }
        
        .reset-button:hover {
            background-color: #bd2130;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .status-bar {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        /* ESTILOS PARA AS SEÇÕES DE INFORMAÇÕES NA TELA */
        .info-section {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .conferente-section {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            background-color: #f0f0f0;
        }
        
        /* ESTILOS PARA IMPRESSÃO */
        @media print {
            .splash-screen {
                display: none !important;
            }
            
            body { 
                background-color: white;
                padding: 0;
                margin: 0;
                font-size: 14px;
            }
            
            .container { 
                box-shadow: none; 
                border: 1px solid #000; 
                max-width: 100%;
                padding: 15px;
            }
            
            .input-section, 
            .action-buttons, 
            .delete-btn, 
            #maco-list,
            .status-bar,
            .summary-section,
            .info-section,
            .conferente-section {
                display: none !important;
            }
            
            .logo-container { 
                display: block !important; 
                margin-bottom: 15px;
                text-align: center;
                background: #f8f9fa !important;
                border: 2px solid #c8102e !important;
            }
            
            .logo-text-print {
                font-family: 'Arial', sans-serif;
                font-size: 1.8em;
                font-weight: bold;
                color: #8b0000 !important;
                margin: 0;
                line-height: 1.2;
            }
            
            .logo-subtitle-print {
                font-family: 'Arial', sans-serif;
                font-size: 0.9em;
                font-weight: bold;
                color: #343a40 !important;
                margin-top: 5px;
            }
            
            .total-section p:has(span:contains("0")) {
                display: none !important;
            }
            
            .total-section .grand-total {
                border-top: 2px solid #000;
                margin-top: 10px;
                padding-top: 10px;
            }
            
            .info-section-print {
                display: block !important;
                text-align: center;
                margin-bottom: 20px;
                border: 1px solid #000;
                padding: 10px;
                border-radius: 5px;
            }
            
            .date-conferente-section {
                display: block !important;
                text-align: center;
                margin-bottom: 20px;
                border: 1px solid #000;
                padding: 10px;
                border-radius: 5px;
            }
        }
        
        .info-section-print {
            display: none;
        }
        
        .date-conferente-section {
            display: none;
        }
        
        .logo-print-only {
            display: none;
        }
        
        /* Responsividade */
        @media (max-width: 480px) {
            .splash-logo {
                font-size: 2.5em;
            }
            
            .splash-subtitle {
                font-size: 1em;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .select-group {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .logo-text {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>

    <!-- TELA DE ABERTURA -->
    <div class="splash-screen" id="splash-screen">
        <div class="splash-logo">JBS</div>
        <div class="splash-subtitle">Novos Negócios</div>
        <div class="splash-loading"></div>
    </div>

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container">
        <div class="logo-container">
            <div class="logo-text">
                CASINGS
            </div>
            <div class="logo-subtitle">FROM JBS</div>
            
            <div class="logo-print-only">
                <div class="logo-text-print">CASINGS</div>
                <div class="logo-subtitle-print">FROM JBS</div>
            </div>
        </div>
        
        <div class="status-bar" id="status-bar">Dados salvos automaticamente</div>
        
        <header><h1>Contagem de Maços</h1></header>

        <div class="info-section">
            <h2>Informações da Caixa</h2>
            <input type="number" id="box-number" placeholder="Número da Caixa" onkeyup="salvarDados()">
            <input type="text" id="owner-name" placeholder="Contador" onkeyup="salvarDados()">
        </div>

        <div class="conferente-section">
            <h2>Informações da Contagem</h2>
            <input type="text" id="conferente-name" placeholder="Conferente" onkeyup="salvarDados()">
        </div>

        <div class="info-section-print" id="info-section-print">
            <h2>Informações da Caixa</h2>
            <p><strong>Número da Caixa:</strong> <span id="print-box-number"></span></p>
            <p><strong>Contador:</strong> <span id="print-owner-name"></span></p>
        </div>

        <div class="date-conferente-section" id="date-conferente-section">
            <h2>Informações da Contagem</h2>
            <p><strong>Data da Contagem:</strong> <span id="print-data-contagem"></span></p>
            <p><strong>Conferente:</strong> <span id="print-conferente-name"></span></p>
        </div>

        <div class="input-section">
            <h2>Adicionar Contagem</h2>
            <input type="number" id="quantidade" placeholder="Adicionar N° de Maços" min="1" onkeydown="handleEnterKey(event)">
            <h3>Tipo do Maço</h3>
            <div class="select-group" id="tipo-group">
                <button type="button" onclick="selectTipo(this)">1º Corte</button>
                <button type="button" onclick="selectTipo(this)">2º Corte</button>
                <button type="button" onclick="selectTipo(this)">Grossa</button>
            </div>
            <h3>Metragem</h3>
            <div class="select-group" id="metragem-group">
                <button type="button" onclick="selectMetragem(this)">90m</button>
                <button type="button" onclick="selectMetragem(this)">50m</button>
                <button type="button" onclick="selectMetragem(this)">30m</button>
                <button type="button" onclick="selectMetragem(this)">15+15m</button>
                <button type="button" onclick="selectMetragem(this)">9+9m</button>
            </div>
            <button class="add-button" onclick="adicionarEntrada()">Adicionar</button>
        </div>

        <div class="summary-section">
            <h2>Lançamentos</h2>
            <ul id="maco-list"></ul>
        </div>

        <div class="total-section">
            <h2>Totalização</h2>
            <p>Total de Maços (90m): <span id="total-90m">0</span></p>
            <p>Total de Maços (50m): <span id="total-50m">0</span></p>
            <p>Total de Maços (30m): <span id="total-30m">0</span></p>
            <p>Total de Maços (15+15m): <span id="total-1515m">0</span></p>
            <p>Total de Maços (9+9m): <span id="total-99m">0</span></p>
            <p class="grand-total">Total Geral de Maços: <span id="total-geral">0</span></p>
            <p class="converted-total">Total Convertido: <span id="total-convertido">0</span></p>
        </div>
        
        <div class="action-buttons">
            <button class="print-button" onclick="imprimirRelatorio()">Imprimir</button>
            <button class="email-button" onclick="enviarEmailComPDF()">Enviar por E-mail</button>
            <button class="reset-button" onclick="resetarContagem()">Resetar Tudo</button>
        </div>
    </div>

    <!-- LÓGICA (JAVASCRIPT) -->
    <script>
        // Inicializando o jsPDF
        const { jsPDF } = window.jspdf;
        
        let lancamentos = [];
        let selectedTipo = null;
        let selectedMetragem = null;

        const macoList = document.getElementById('maco-list');
        const quantidadeInput = document.getElementById('quantidade');
        const boxNumberInput = document.getElementById('box-number');
        const ownerNameInput = document.getElementById('owner-name');
        const conferenteNameInput = document.getElementById('conferente-name');
        const statusBar = document.getElementById('status-bar');
        const splashScreen = document.getElementById('splash-screen');

        // FUNÇÃO PARA DETECTAR ENTER E LANÇAR O MAÇO
        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                adicionarEntrada();
            }
        }

        // FUNÇÕES PARA SELECIONAR
        function selectTipo(button) {
            document.querySelectorAll('#tipo-group button').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            selectedTipo = button.textContent;
        }

        function selectMetragem(button) {
            document.querySelectorAll('#metragem-group button').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            selectedMetragem = button.textContent;
        }

        // FUNÇÃO PARA SALVAR OS DADOS NO NAVEGADOR
        function salvarDados() {
            const dados = {
                boxNumber: boxNumberInput.value,
                ownerName: ownerNameInput.value,
                conferenteName: conferenteNameInput.value,
                lancamentos: lancamentos
            };
            localStorage.setItem('dadosContador', JSON.stringify(dados));
            
            statusBar.style.display = 'block';
            setTimeout(() => {
                statusBar.style.display = 'none';
            }, 2000);
        }

        // FUNÇÃO PARA CARREGAR OS DADOS QUANDO A PÁGINA ABRE
        function carregarDados() {
            const dadosSalvos = localStorage.getItem('dadosContador');
            if (dadosSalvos) {
                const dados = JSON.parse(dadosSalvos);
                boxNumberInput.value = dados.boxNumber || '';
                ownerNameInput.value = dados.ownerName || '';
                conferenteNameInput.value = dados.conferenteName || '';
                lancamentos = dados.lancamentos || [];
                renderList();
                updateTotals();
            }
        }

        function adicionarEntrada() {
            const quantidade = parseInt(quantidadeInput.value);
            if (!quantidade || quantidade <= 0) { 
                alert('Insira uma quantidade válida.'); 
                return; 
            }
            if (!selectedTipo) { 
                alert('Selecione o tipo do maço.'); 
                return; 
            }
            if (!selectedMetragem) { 
                alert('Selecione a metragem.'); 
                return; 
            }

            lancamentos.push({ 
                id: Date.now(), 
                quantidade, 
                tipo: selectedTipo, 
                metros: selectedMetragem 
            });

            renderList();
            updateTotals();
            salvarDados();
            
            // Limpar campos após adicionar
            quantidadeInput.value = '';
            quantidadeInput.focus();
        }

        function renderList() {
            macoList.innerHTML = '';
            lancamentos.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${item.quantidade} maço(s) - ${item.tipo} - ${item.metros}</span>
                    <button class="delete-btn" onclick="removerEntrada(${item.id})">×</button>
                `;
                macoList.appendChild(li);
            });
        }

        function removerEntrada(id) {
            lancamentos = lancamentos.filter(item => item.id !== id);
            renderList();
            updateTotals();
            salvarDados();
        }

        function updateTotals() {
            const totals = {
                '90m': 0,
                '50m': 0,
                '30m': 0,
                '15+15m': 0,
                '9+9m': 0
            };

            lancamentos.forEach(item => {
                if (totals.hasOwnProperty(item.metros)) {
                    totals[item.metros] += item.quantidade;
                }
            });

            document.getElementById('total-90m').textContent = totals['90m'];
            document.getElementById('total-50m').textContent = totals['50m'];
            document.getElementById('total-30m').textContent = totals['30m'];
            document.getElementById('total-1515m').textContent = totals['15+15m'];
            document.getElementById('total-99m').textContent = totals['9+9m'];

            const totalGeral = Object.values(totals).reduce((sum, value) => sum + value, 0);
            document.getElementById('total-geral').textContent = totalGeral;

            // FÓRMULA CORRETA: quantidade × metragem ÷ 30
            let totalConvertido = 0;
            
            // 90m: quantidade × 90 ÷ 30 = quantidade × 3
            totalConvertido += totals['90m'] * 3;
            
            // 50m: quantidade × 50 ÷ 30 = quantidade × 1.666...
            totalConvertido += totals['50m'] * (50/30);
            
            // 30m: quantidade × 30 ÷ 30 = quantidade × 1
            totalConvertido += totals['30m'] * 1;
            
            // 15+15m: quantidade × 30 ÷ 30 = quantidade × 1
            totalConvertido += totals['15+15m'] * 1;
            
            // 9+9m: quantidade × 18 ÷ 30 = quantidade × 0.6
            totalConvertido += totals['9+9m'] * (18/30);

            // ARREDONDAMENTO APENAS NO VALOR FINAL
            const totalArredondado = Math.round(totalConvertido);
            document.getElementById('total-convertido').textContent = totalArredondado;
        }

        // FUNÇÃO PARA IMPRIMIR RELATÓRIO
        function imprimirRelatorio() {
            // Atualizar informações da caixa para impressão
            document.getElementById('print-box-number').textContent = boxNumberInput.value || '-';
            document.getElementById('print-owner-name').textContent = ownerNameInput.value || '-';
            document.getElementById('print-conferente-name').textContent = conferenteNameInput.value || '-';
            
            // Adicionar data atual
            const dataAtual = new Date();
            const dataFormatada = dataAtual.toLocaleDateString('pt-BR');
            document.getElementById('print-data-contagem').textContent = dataFormatada;
            
            // Chamar a impressão
            window.print();
        }

        function enviarEmailComPDF() {
            alert('Funcionalidade de e-mail será implementada em breve.');
        }

        function resetarContagem() {
            if (confirm('Tem certeza que deseja resetar toda a contagem?')) {
                lancamentos = [];
                boxNumberInput.value = '';
                ownerNameInput.value = '';
                conferenteNameInput.value = '';
                renderList();
                updateTotals();
                salvarDados();
            }
        }

        // REMOVER SPLASH SCREEN APÓS 2 SEGUNDOS
        setTimeout(function() {
            splashScreen.style.display = 'none';
        }, 2000);

        // Inicializar a página
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            // O foco no input será automático após a animação
            setTimeout(() => {
                quantidadeInput.focus();
            }, 2500);
        });
    </script>
</body>
</html>
